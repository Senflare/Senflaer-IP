# Senflare-IP

自动收集、验证Cloudflare IPv4地址并按地区格式化的工具

## 项目介绍

Senflare-IP 是一个轻量级工具，用于自动化收集公开的Cloudflare IPv4地址，通过多维度验证筛选可用节点，并按国家/地区分组格式化输出。适用于需要快速获取可用Cloudflare节点的场景（如网络加速、节点优选等）。

项目核心特点：
- **全自动流程**：定时收集、验证、更新，无需人工干预
- **精准筛选**：通过TCP端口检测和延迟评估，确保IP可用性
- **地区分类**：识别IP所属国家/地区，按地区分组编号
- **灵活输出**：生成纯IP列表和带地区信息的格式化列表

## 功能特性

1. **多源IP收集**：从多个可靠来源抓取Cloudflare IPv4地址
2. **严格可用性验证**：
   - 基础TCP连通性检测（443端口）
   - 多端口服务验证（[443/2053/2083/2087/2096/8443]）
   - 延迟评估与排序（优先保留低延迟节点）
3. **地区识别**：通过IP信息API识别所属国家/地区
4. **自动化更新**：通过GitHub Actions每3小时自动运行并更新结果
5. **双重输出格式**：
   - `IPlist.txt`：纯可用IP地址列表
   - `Senflare.txt`：带地区代码、名称和序号的格式化列表

## 使用方法

### 直接使用结果文件

项目会自动生成并更新两个核心文件，可直接下载使用：

- [IPlist.txt](IPlist.txt)：仅包含可用IPv4地址（每行一个）
- [Senflare.txt](Senflare.txt)：格式化列表，格式为 `IP#国家代码 地区名称节点|序号`

示例（Senflare.txt）：
104.18.1.1#US 美国节点|01
172.67.1.1#SG 新加坡节点|01
### 本地运行脚本

如果需要本地自定义运行：

1. 克隆仓库
   ```bash
   git clone https://github.com/your-username/Senflare-IP.git
   cd Senflare-IP
   ```

2. 安装依赖
   ```bash
   pip install -r requirements.txt
   ```

3. 运行脚本
   ```bash
   python ip_collector.py
   ```

4. 查看输出文件（同目录下生成上述两个结果文件）

## 工作原理

1. **IP收集**：从配置的多个来源抓取IPv4地址，去重后形成原始列表
2. **可用性验证**：
   - 先通过TCP Ping检测基础网络连通性
   - 再通过多端口连接测试验证服务可用性
   - 记录延迟并筛选低延迟节点
3. **地区识别**：调用IP信息API获取国家/地区代码，映射为中文名称
4. **结果格式化**：按地区分组，同一地区内按延迟排序并编号
5. **自动更新**：通过GitHub Actions定时执行上述流程，自动提交更新结果

## 自定义配置

可通过修改 `ip_collector.py` 中的 `CONFIG` 字典调整参数：
- `ip_sources`：添加/移除IP来源地址
- `test_ports`：修改需要验证的端口
- `timeout`：调整连接超时时间（秒）
- `retries`：修改重试次数

## 自动化流程

项目通过GitHub Actions实现全自动化：
- 触发条件：每3小时自动运行 + 支持手动触发
- 运行环境：Ubuntu最新版
- 流程：拉取代码 → 配置Python环境 → 安装依赖 → 运行脚本 → 提交结果

查看工作流配置：[ip-collection.yml](.github/workflows/main.yml)
